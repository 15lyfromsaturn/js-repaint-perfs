/*
 https://github.com/leeoniya/domvm (1.x-dev)
*/
("undefined"!==typeof global?global:this).domvm={};(function(t){var u=("undefined"==typeof window?{}:window).requestAnimationFrame,w={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,columnCount:!0,counterIncrement:!0,fillOpacity:!0,flex:!0,flexGrow:!0,flexOrder:!0,flexPositive:!0,flexShrink:!0,"float":!0,fontWeight:!0,gridColumn:!0,lineHeight:!0,lineClamp:!0,opacity:!0,order:!0,orphans:!0,stopOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0,tabSize:!0,transform:!0,transformOrigin:!0,widows:!0,zIndex:!0,zoom:!0},r={TYPE_ELEM:1,
TYPE_TEXT:2,isArr:function(c){return c instanceof Array},isVal:function(c){c=typeof c;return"string"===c||"number"===c},isObj:function(c){return"object"===typeof c&&null!==c&&!r.isArr(c)},isFunc:function(c){return"function"===typeof c},isProm:function(c){return"object"===typeof c&&r.isFunc(c.then)},execAll:function(c,g,p,k,q,t){var u;c&&(r.isArr(c)?c:[c]).forEach(function(c){u=c.call(null,g,p,k,q,t)});return u},tick:function(c,g){g&&u?u&&u(function(){r.tick(c,g-1)}):r.isArr(c)?c[0].apply(null,c.slice(1)):
c()},insertArr:function(c,g,p,k){c.splice.apply(c,[p,k].concat(g))},isEvProp:function(c){return"on"===c.substr(0,2)},isDynProp:function(c,g){switch(c){case "input":case "textarea":case "select":case "option":switch(g){case "value":case "checked":case "selected":case "selectedIndex":return!0}}},camelDash:function(c){return c.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},autoPx:function(c,g){return isNaN(g)||w[c]?g:g+"px"},deepSet:function(c,g,p){g=g.split(".");var k=g.pop();g.forEach(function(g){c[g]||
(c[g]={});c=c[g]});c[k]=p},deepGet:function(c,g){var p=g.split(".");do c=c[p.shift()];while(p.length);return c},keyedIdx:function(c,g,p,k,q){for(k=0;k<g.length;k++)if(q=g[k],q.key===c)if(p){if(q.vm&&q.vm.view[0]===p)return k}else return k;return-1},raft:function(c){function g(){p=0;c.apply(k,q)}if(!u)return c;var p,k,q;return function(){k=this;q=arguments;p||(p=u(g))}}};t.utils=r})(domvm);(function(t){function u(){for(var a;a=E.pop();)a[0].apply(null,a.slice(1))}function w(a,b){return!1===b?null:null==b&&null!=a?a:e.isVal(b)||e.isObj(b)||e.isArr(b)||e.isFunc(b)?b:null}function r(a,b,h,l,d,x){function m(a,b,d){if(d)a[b]=a[b]||[],a[b].push(d);else for(var h in b)a[h]=a[h]||[],a[h].push(b[h])}function f(a,b,h){d=a;x=b;n.update(h,!1);return k(0,!1)}function v(a){return null==a?"":a}function k(a,l){if(a){for(var f=n;a--&&f.parent;)f=f.parent;f.redraw(0,!0);return f.vm}(f=n.node)&&g(n,"willRedraw",
n);n.refs={};var c=n.render.call(n.api,n,b,h),c=q(c,d,x,n);c.vm=n;n.node=c;var m=e.isVal(h)&&"^"===h[0]?h.substr(1):e.isVal(c.ref)&&"^"===c.ref[0]?c.ref.substr(1):null;c.key=null!=h?h:c.key;for(var v=d;v;)v.vm&&(n.parent||(n.parent=v.vm),null!==m&&e.deepSet(v.vm.refs,m,c)),v=v.parent;if((m=f)&&(c.type!==f.type||c.tag!==f.tag))var m=null,t=!0,F=f.el.parentNode;z(c,m);d&&(d.body[x]=c);!1!==l&&(f&&p(f),!f&&r||A(c,null,c.el),t&&(F||c.parent.el).insertBefore(c.el,F.childNodes[f.idx]));f&&g(n,"didRedraw",
n);!1!==l&&e.tick(u,2);return n}var r=!d;e.isArr(a)&&(b=a[1],h=a[2],l=a[3],a=a[0]);h=w(b,h);var n={api:{},node:null,view:[a,h],model:b,opts:l||{},render:null,update:function(a,d){null==a||h===b&&!e.isVal(h)||(b=n.model=a);return!1!==d?k(0):n},on:function(a,b){m(n.events,a,b)},hook:function(a,b){n.hooks=n.hooks||{};m(n.hooks,a,b)},events:{},hooks:null,redraw:B.useRaf?e.raft(k):k,patch:function(a,b){var d=null!=a.el;if(e.isObj(b)){var h="class"in b?(v(a["class"])+" "+v(b["class"])).trim():a.props["class"],
l="style"in b?b.style:a.props.style;d&&(d=Object.create(a.props),d["class"]=h,d.style=l,d={tag:a.tag,el:a.el,ns:a.ns,props:d},C(d,a));a.props["class"]=h;a.props.style=l}else h=a.parent,d=z(q(b,h,a.idx,n),a),h.body[a.idx]=d},emit:function(a){for(var b=Array.prototype.slice.call(arguments),d=n,h;d;){if(h=d.events[a]){b[0]=h;e.execAll.apply(null,b);break}d=d.parent}},refs:{},parent:null,mount:function(a,b){var d=null;b&&(a.textContent="",d=a,a=null);A(n.node,d,null,a);return n},attach:function(a){c(n.node,
a);return n},unmount:function(){p(n.node)},moveTo:f,updIdx:function(a){x=a}};l&&l.hooks&&n.hook(l.hooks);e.execAll(y,n);n.render=a.call(n.api,n,b,h);return d?f(d,x):k(0)}function c(a,b){a.el=b;b._node=a;for(var h in a.props){var l=a.props[h],d=e.isEvProp(h)?h:"."===h[0]?h.substr(1):null;null!==d&&(b[d]=l)}if(e.isArr(a.body))for(h=0;h<a.body.length;h++)c(a.body[h],b.childNodes[h])}function g(a,b,h,l,d,c){if(a&&a.hooks&&(a=a.hooks[b]))if(B.useRaf&&"did"==b.substr(0,3))E.push([e.execAll,a,h,l,d,c]);
else return e.execAll(a,h,l,d,c)}function p(a,b){var h=a.el&&!a.moved;if(h){var l=g(a.vm,"willUnmount",a.vm),d=g(a,"willRemove",a),c=l||d;a.removed=!0}e.isArr(a.body)&&a.body.forEach(function(a,d){p(a,b||c)});b||(c?c.then(function(){k(a,h)}):k(a,h))}function k(a,b){null!=a.el&&a.el.parentNode&&(b&&(a.el.parentNode.removeChild(a.el),a.el=null,g(a.vm,"didUnmount",a.vm),g(a,"didRemove",a)),e.isArr(a.body)&&a.body.forEach(function(a,b){k(a,!0)}),a.vm=a.body=null)}function q(a,b,h,l){var d=a;a={type:null,
key:null,ref:null,idx:null,parent:null,moved:!1,removed:!1,hooks:null,tag:null,"class":null,ns:null,guard:!1,raw:!1,props:null,el:null,hasKeys:!1,body:null};e.isFunc(d)&&(d=d());if(e.isArr(d)&&d.length){a.type=e.TYPE_ELEM;if(1<d.length){var c=1;e.isObj(d[1])&&(a.props=d[1],c=2);a.body=d.length==c+1?e.isVal(d[c])?d[c]:e.isFunc(d[c])?d[c]():d.slice(c):d.slice(c)}a.tag=d[0];J(a);if(a.props){var d=a.props,m;for(m in d)e.isEvProp(m)?d[m]=K(d[m],l.opts.evctx||l.model||null,a,l):e.isFunc(d[m])&&("href"==
m?(d.onclick=d[m],d.href=d[m].href):d[m]=d[m]()),e.isDynProp(a.tag,m)&&(d["."+m]=d[m]);if(e.isObj(d.style))for(var f in d.style)m=d.style[f],e.isFunc(m)&&(d.style[f]=m());e.isObj(d._hooks)&&(a.hooks=d._hooks,d._hooks=null);a.key=e.isVal(d._key)?d._key:e.isVal(d._ref)?d._ref:e.isVal(d.id)?d.id:e.isVal(d.name)?d.name:null;null!=d._ref&&(a.ref=d._ref);d._raw&&(a.raw=!0);null!=d._data&&(a.data=d._data);d._guard&&(a.guard=!0);d._ref=d._key=d._raw=d._data=d._guard=null}}else e.isVal(d)&&(a.type=e.TYPE_TEXT,
a.body=d);null!==a.ref&&e.deepSet(l.refs,a.ref,a);a.parent=b;a.idx=h;a.ns=b&&b.ns?b.ns:"svg"===a.tag||"math"===a.tag?a.tag:null;if(e.isArr(a.body))for(b=0,h=a.body.length;b<h;b++){f=a.body[b];var d=m=null,g=c=!1;e.isFunc(f)&&(f=f());if(null==f)c=!0;else{var k=e.isArr(f),p=k?!1:e.isObj(f);if(k)f.length?"string"==typeof f[0]&&""!==f[0]?(d=q(f,a,b,l),m=d.key):e.isFunc(f[0])?m=w(f[1],f[2]):g=!0:c=!0;else if(p)if(e.isFunc(f.redraw))f.moveTo(a,b),d=f.node,m=f.view[1];else{a.body[b--]=""+f;continue}else""===
f?c=!0:0<b&&a.body[b-1].type===e.TYPE_TEXT?(a.body[b-1].body+=""+f,c=!0):d=q(""+f,a,b,l)}c||g?(g?e.insertArr(a.body,f,b,1):a.body.splice(b,1),h=a.body.length,b--):(null!==m&&(a.hasKeys=!0),a.body[b]=d||f)}return a}function z(a,b){b&&(g(a,"willRecycle",b,a),L(b,a),g(a,"didRecycle",b,a));if(e.isArr(a.body)){var h=0;a.body.forEach(function(c,d){var g=e.isArr(c);if(b){var m=I(c,a,b,h);if(null!==m){var f=m[0],m=m[1];f===h&&h++;f=b.body[f];f.vm?g?2===m?f.vm.moveTo(a,d,c[1]):1===m&&r(c[0],c[1],c[2],c[3],
a,d):c.vm&&2===m&&c.vm===f.vm&&f.vm.moveTo(a,d):a.body[d]=z(c,f);return}}g?r(c[0],c[1],c[2],c[3],a,d):a.body[d]=z(c)})}return a}function A(a,b,c,l){for(var d=!a.el;c&&c._node.removed;)c=c.nextSibling;d&&g(a.vm,"willMount",a.vm);if(a.type==e.TYPE_ELEM)if(d&&(a.el=b||(a.ns?D.createElementNS(M[a.ns],a.tag):D.createElement(a.tag)),a.props&&C(a)),e.isArr(a.body)){b=0;for(var k=a.el.firstChild;b<a.body.length;b++)k=A(a.body[b],null,k)}else e.isVal(a.body)&&(a.raw?a.el.innerHTML=a.body:d&&(a.el.textContent=
a.body));else a.type==e.TYPE_TEXT&&d&&(a.el=D.createTextNode(a.body));a.el._node=a;b=a.parent;c!==a.el&&(l||b&&b.el)&&(b=d?"Insert":"Reinsert",g(a,"will"+b,a),(l||a.parent.el).insertBefore(a.el,c),g(a,"did"+b,a));d&&a.vm&&a.vm.hooks&&!a.moved&&g(a.vm,"didMount",a.vm);return c!==a.el?c:c.nextSibling}function I(a,b,c,l,d){var g=e.isArr(a),m=g?w(a[1],a[2]):a.key,f=c.hasKeys,k=b.hasKeys;c=c.body;b=b.body;if(null!==m&&f)return a=e.keyedIdx(m,c,g?a[0]:null),-1<a?[a,2]:null;l=l||0;if(l>c.length-1)return null;
d=0===d?0:d||c.length-1;for(m=null;l<=d;l++)if(f=c[l],null!==f&&f.el)if(g&&f.vm){if(f.vm.view[0]===a[0]){if(f.vm.view[1]===w(a[1],a[2]))return[l,2];!m&&k&&-1==e.keyedIdx(f.key,b,f.vm.view[0])&&(m=[l,1])}}else if(a.type===f.type&&(a.type===e.TYPE_TEXT||null!==a.tag&&a.tag===f.tag)&&(null===f.key||!k||-1==e.keyedIdx(f.key,b,f.vm?f.vm.view[0]:null)))return[l,1];return m}function L(a,b){b.el=a.el;a.el=null;b.el&&(b.el._node=b);if(b.type===e.TYPE_TEXT&&b.body!==a.body)b.el.nodeValue=b.body;else{C(b,a);
var c=!e.isArr(b.body),l=!e.isArr(a.body);c&&b.body!==a.body?l&&b.el.firstChild?b.el.firstChild.nodeValue=b.body:b.raw?b.el.innerHTML=b.body:b.el.textContent=b.body:l&&!c&&(b.el.textContent="");a.moved=!0}}function J(a){/[.#]/.test(a.tag)&&(a.tag=a.tag.replace(/^([\w\-]+)?(?:#([\w\-]+))?((?:\.[\w\-]+)+)?$/,function(b,c,e,d){d&&(d=d.replace(/\./g," ").trim());if(e||d)b=a.props||{},e&&null==b.id&&(b.id=e),d&&(a["class"]=d,b["class"]=d+(null!=b["class"]?" "+b["class"]:"")),a.props=b;return c||"div"}))}
function K(a,b,c,l){return function(d){var c,h=d.target._node,f=null;if(e.isFunc(a))c=a.call(b,d,h,l);else if(e.isArr(a))f=a.slice(1),c=a[0].apply(b,f.concat(d,h,l));else if(e.isObj(a))for(var g in a){var k=a[g];d.target.matches(g)&&(e.isArr(k)?(f=k.slice(1),c=k[0].apply(b,f.concat(d,h,l))):e.isFunc(k)&&(c=k.call(b,d,h,l)))}!1===c&&(d.preventDefault(),d.stopPropagation());l.opts.hasOwnProperty("watch")&&l.opts.watch.fire({type:"event",vm:l,node:h,event:d,data:f})}}function C(a,b){var c=!b;b=b||{};
if(b.props||a.props){var l=b.props||{},d=a.props||{},g=l.style,m=d.style;if(e.isObj(g)||e.isObj(m))G(a.el,a.tag,g||{},m||{},N,O,a.ns,c),l.style=d.style=null;G(a.el,a.tag,l,d,P,H,a.ns,c);m&&(d.style=m)}}function G(a,b,c,e,d,g,m,f){for(var k in e)null!==e[k]&&("."===k[0]?a[k.substr(1)]!==e[k]:e[k]!==c[k])&&d(a,k,e[k],m,f);for(k in c)null!==c[k]&&null==e[k]&&g(a,k,m,f)}function N(a,b,c){a.style[b]=e.autoPx(b,c)}function O(a,b){a.style[b]=""}function P(a,b,c,g,d){"."===b[0]?(b=b.substr(1),"svg"===g?a[b].baseVal=
c:a[b]=c):"class"===b?a.className=c:"id"===b||e.isEvProp(b)?a[b]=c:!1===c?H(a,b,g,d):a.setAttribute(b,!0===c?"":c)}function H(a,b,c,g){g||("."===b[0]?(b=b.substr(1),"svg"===c?a[b].baseVal=null:a[b]=null):"class"===b?a.className="":"id"===b||e.isEvProp(b)?a[b]=null:a.removeAttribute(b))}var M={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},D="undefined"==typeof document?{}:document,E=[],B={useRaf:!0};t.view=r;t.view.config=function(a){B=a};var y=null;t.view.extend=function(a,
b){y=!y||b?[]:y;y.push(a)};var e=t.utils;return t})(domvm);
